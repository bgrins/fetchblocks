<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <style>
      body {
        display: grid;
        grid-template-columns: 1fr 1fr;
      }
    </style>
  </head>
  <body>
    <pre id="plan">Plan:</pre>
    <pre id="run">Run:</pre>

    <script type="module">
      import { fetchblock } from "https://esm.sh/@bgrins/fetchblocks/web/bundle-module.js";

      let block = new fetchblock([
        {
          resource: "https://x-colors.herokuapp.com/api/random/{{dataset.hue}}",
        },
        { type: "jmespath", value: "hex" },
      ]);

      block.addEventListener("PlanReady", (e) => {
        document.querySelector("#plan").textContent +=
          "\n" + JSON.stringify(e.detail, null, 2);
      });
      block.addEventListener("StepStarting", (e) => {
        document.querySelector("#run").textContent +=
          "\nStepStarting" + JSON.stringify(e.detail, null, 2);
      });
      block.addEventListener("StepComplete", (e) => {
        document.querySelector("#run").textContent +=
          "\nStepComplete" + JSON.stringify(e.detail, null, 2);
      });
      let result = await block.run({
        dataset: {
          hue: 1,
        },
      });
      console.log(result);
    </script>
  </body>
</html>
